
 // nodes from neo-mon and happy nodes
var nodesg = [ {"id": "http://seed1.aphelion-neo.com:10332", "ip": "18.194.0.22", "color": "red", "value": 10 },
{"id": "http://seed2.aphelion-neo.com:10332", "ip": "18.196.141.225", "color": "red" },
{"id": "http://seed3.aphelion-neo.com:10332", "ip": "35.157.159.215", "color": "red" },
{"id": "http://seed4.aphelion-neo.com:10332", "ip": "35.157.89.64", "color": "red" },

{"id": "http://node2.ams2.bridgeprotocol.io:10332", "ip": "37.139.22.119", "color": "red" },
{"id": "http://node1.ams2.bridgeprotocol.io:10332", "ip": "198.211.127.188", "color": "red" },
{"id": "http://node1.nyc3.bridgeprotocol.io:10332", "ip": "165.227.186.72", "color": "red" },
{"id": "http://node2.nyc3.bridgeprotocol.io:10332", "ip": "159.65.244.191", "color": "red" },
{"id": "http://node1.sgp1.bridgeprotocol.io:10332", "ip": "206.189.94.221", "color": "red" },
{"id": "http://node2.sgp1.bridgeprotocol.io:10332", "ip": "206.189.152.158", "color": "red" },


{"id": "http://seed1.travala.com:10332", "ip": "52.74.91.157", "color": "red" },

{"id": "https://seed1.neo.org:10331", "ip": "47.94.164.49", "color": "red" },
{"id": "http://seed2.neo.org:10332", "ip": "139.219.106.33", "color": "red" },
{"id": "http://seed3.neo.org:10332", "ip": "47.89.178.72", "color": "red" },
{"id": "http://seed4.neo.org:10332", "ip": "47.88.53.224", "color": "red" },
{"id": "http://seed5.neo.org:10332", "ip": "47.91.92.192", "color": "red" },

{"id": "http://seed.neoeconomy.io:10332", "ip": "144.217.163.253", "color": "red" },

{"id": "https://seed1.switcheo.network:10331", "ip": "54.179.146.99", "color": "red" },
{"id": "https://seed2.switcheo.network:10331", "ip": "52.76.83.78", "color": "red" },
{"id": "https://seed3.switcheo.network:10331", "ip": "54.179.146.99", "color": "red" }, ///
{"id": "https://seed4.switcheo.network:10331", "ip": "54.179.146.99", "color": "red" },//
{"id": "https://seed5.switcheo.network:10331", "ip": "54.169.247.222", "color": "red" },

{"id": "http://api.otcgo.cn:10332", "ip": "121.42.26.131", "color": "red" },//22

{"id": "https://seed0.cityofzion.io:443", "ip": "89.145.165.128", "color": "red" },
{"id": "https://seed1.cityofzion.io:443", "ip": "13.58.252.110", "color": "red" },
{"id": "https://seed2.cityofzion.io:443", "ip": "18.216.146.68", "color": "red" },
{"id": "https://seed3.cityofzion.io:443", "ip": "18.217.91.255", "color": "red" },
{"id": "https://seed4.cityofzion.io:443", "ip": "18.218.62.119", "color": "red" },
{"id": "https://seed5.cityofzion.io:443", "ip": "52.14.228.80", "color": "red" },
{"id": "https://seed6.cityofzion.io:443", "ip": "89.145.165.6", "color": "red" },
{"id": "https://seed7.cityofzion.io:443", "ip": "89.145.163.49", "color": "red" },
{"id": "https://seed8.cityofzion.io:443", "ip": "185.150.9.151", "color": "red" },
{"id": "https://seed9.cityofzion.io:443", "ip": "185.150.8.221", "color": "red" },

{"id": "https://seed1.redpulse.com:443", "ip": "35.158.117.74", "color": "red" },//33
{"id": "https://seed2.redpulse.com:443", "ip": "13.229.98.18", "color": "red" },

{"id": "https://seed1.spotcoin.com:10332", "ip": "18.194.110.81", "color": "red" },

{"id": "http://rustylogic.ddns.net:10332", "ip": "77.99.237.221", "color": "red" },

{"id": "http://seed1.ngd.network:10332", "ip": "47.254.28.42", "color": "red" },
{"id": "http://seed2.ngd.network:10332", "ip": "47.89.253.82", "color": "red" },
{"id": "http://seed3.ngd.network:10332", "ip": "47.52.168.73", "color": "red" },
{"id": "http://seed4.ngd.network:10332", "ip": "47.91.248.98", "color": "red" },
{"id": "http://seed5.ngd.network:10332", "ip": "47.97.73.20", "color": "red" },
{"id": "http://seed6.ngd.network:10332", "ip": "47.254.44.88", "color": "red" },
{"id": "http://seed7.ngd.network:10332", "ip": "47.254.83.14", "color": "red" },
{"id": "http://seed8.ngd.network:10332", "ip": "47.254.43.76", "color": "red" },
{"id": "http://seed9.ngd.network:10332", "ip": "47.91.225.117", "color": "red" },
{"id": "http://seed10.ngd.network:10332", "ip": "47.52.159.228", "color": "red" },

{"id": "https://seed1.red4sec.com:10332", "ip": "51.75.27.231", "color": "red" },

{"id": "http://node1.plutolo.gy:10332", "ip": "51.75.201.174", "color": "red" }, //49

{"id": "http://172.105.228.12:10332", "ip": "172.105.228.12", "color": "red", "loc":"Japan" },

{"id": "http://101.100.174.24:10332", "ip": "101.100.174.24", "color": "red" },

{"id": "http://108.252.121.18:10332", "ip": "108.252.121.18", "color": "red" },

{"id": "http://178.79.191.196:10332", "ip": "178.79.191.196", "color": "red" },

{"id": "http://47.254.64.251:10332", "ip": "47.254.64.251", "color": "red" },

{"id": "http://47.254.31.231:10332", "ip": "47.254.31.231", "color": "red" },

{"id": "http://35.236.147.196:10332", "ip": "35.236.147.196", "color": "red" },

{"id": "http://47.75.174.167:10332", "ip": "47.75.174.167", "color": "red" },

{"id": "http://103.41.107.195:10332", "ip": "103.41.107.195", "color": "red" }, //58

{"id": "http://114.215.30.71:10332", "ip": "114.215.30.71", "color": "red" },

{"id": "https://35.157.205.68:10332", "ip": "35.157.205.68", "color": "red" },

{"id": "http://23.99.143.74:10332", "ip": "23.99.143.74", "color": "red" },

{"id": "http://52.204.61.212:10332", "ip": "52.204.61.212", "color": "red" },

{"id": "http://13.230.32.107:10332", "ip": "13.230.32.107", "color": "red" },

{"id": "http://167.99.143.122:10331", "ip": "167.99.143.122", "color": "red" },

{"id": "http://159.100.255.130:10332", "ip": "159.100.255.130", "color": "red" },

{"id": "http://54.169.87.223:10332", "ip": "54.169.87.223", "color": "red" },

{"id": "http://185.195.255.164:10332", "ip": "185.195.255.164", "color": "red" },

{"id": "http://47.75.213.7:10332", "ip": "47.75.213.7", "color": "red" },

{"id": "http://13.236.186.168:10332", "ip": "13.236.186.168", "color": "red" },

{"id": "http://195.201.241.81:10332", "ip": "195.201.241.81", "color": "red" },//70

{"id": "http://47.52.132.248:10332", "ip": "47.52.132.248", "color": "red" },

{"id": "http://178.128.198.255:10332", "ip": "178.128.198.255", "color": "red" },

{"id": "https://52.28.40.92:10332", "ip": "52.28.40.92", "color": "red" },

{"id": "http://207.154.220.233:10332", "ip": "207.154.220.233", "color": "red" },

{"id": "http://120.79.24.81:10332", "ip": "120.79.24.81", "color": "red" },

{"id": "http://47.75.115.81:10332", "ip": "47.75.115.81", "color": "red" },

{"id": "http://139.162.45.250:10332", "ip": "139.162.45.250", "color": "red" },

{"id": "http://47.106.202.182:10332", "ip": "47.106.202.182", "color": "red" },

{"id": "http://139.129.235.173:10332", "ip": "139.129.235.173", "color": "red" },

{"id": "http://13.231.37.13:10332", "ip": "13.231.37.13", "color": "red" },//80

{"id": "http://47.75.143.59:10332", "ip": "47.75.143.59", "color": "red" },

{"id": "http://101.132.97.9:10332", "ip": "101.132.97.9", "color": "red" },

{"id": "http://106.14.212.33:10332", "ip": "106.14.212.33", "color": "red" },

{"id": "http://47.98.144.178:10332", "ip": "47.98.144.178", "color": "red" },

{"id": "http://35.194.176.211:10332", "ip": "35.194.176.211", "color": "red" },

{"id": "http://172.105.228.12:10332", "ip": "172.105.228.12", "color": "red" },//86


];



setInterval(runbest, 5000);

var bestbl, ind, counter2, bestago;

// update bestblock
function runbest() {

  for (var i = 0; i < nodesg.length; ++i) { // get last blocks of nodes
    blc(i)
    };

    setTimeout(outbl, 1500);

    function outbl() {
    for (var x = 0; x < blocks.length; ++x) {
      (blocks[x] == undefined) ? blocks[x] = 0 : {};
      };
     bestbl = Math.max.apply(null, blocks);
     if (bestbl != bestago) { (bestago != undefined) ? counter2 = -1 : {};  bestago = bestbl;
     } 
    } 

}

//update time
async function timerun(ind) {
  var has, tim;
  await neo.node(nodesg[ind].id).getBestBlockHash().then(function (result) {
    has = result	
    }); 

    await neo.node(nodesg[ind].id).getBlock(has, 1).then(function (result) {
    tim = result.time;
     }); 
        
  var x = moment().unix();
  var y = tim;
  ago = x - y;

  counter2 = ago;

  setInterval((function () {document.getElementById('lasttime').innerText =  (++counter2) ;
  document.getElementById('bestblock').innerText =  bestbl;
  }), 1000);	

}


// get ip array and blockcount array
var blocks = [];
function blc(i){
  neo.node(nodesg[i].id).getBlockCount().then(function (result) {blocks[i] = result; });
}

var ips = [];
for (var i = 0; i < nodesg.length; ++i) {
ips[i] = nodesg[i].ip;
blc(i)
}


// get all peers

var peersx = [];

 function gp (i) {
   try {
  neo.node(nodesg[i].id).getPeers().then(function (result) {peersx[i] = result.connected});
   } catch(e) {return}
 }
  
for (var i = 0; i < nodesg.length; ++i) {
  gp(i); 
};

//setTimeout(getl, 1000);

// create links array and draw graph
function getl () {

 
var linksx = [];
var index, diffx;
 
for (var x = 0; x < nodesg.length; ++x) {
(blocks[x] == undefined) ? blocks[x] = 0 : {};
};
for (var j = 0; j < nodesg.length; ++j) {
bestbl =  Math.max.apply(null, blocks);
diffx = blocks[j] - bestbl;
ind = blocks.indexOf(bestbl);


(blocks[j] == 0) ? nodesg[j].color = 'Red' :
(diffx < -100) ? nodesg[j].color = 'OrangeRed' :
(diffx < -10) ? nodesg[j].color = 'DarkOrange' : 
(diffx < -3) ? nodesg[j].color = 'Yellow' : 
(diffx  <= 0) ? nodesg[j].color = 'Lime' : {}
  
  try {

    for (var k of peersx[j]) { 
       index =  ips.indexOf(k.address);
        if (~index) {
        if (blocks[index] == 0) continue //detect unreachable nodes
            linksx.push({
            source : nodesg[j].id,
            target : nodesg[index].id
             })
        }  
    }
  } catch(e) {continue}    
  };

  timerun(ind); // run timer
  runbest();

  // draw graph
  const gData = {
  nodes: nodesg,
  links: linksx
  };
 
  const elem = document.getElementById('dg');
  const Graph = ForceGraph3D()
 // { controlType: 'orbit' }
      (elem)
      .graphData(gData)
      .width(850)
      .height(500)
      .backgroundColor('#212A3F')
     .nodeLabel('id')
     .nodeResolution(16)
     .linkWidth(1)
     .linkDirectionalParticles(10)
      .onNodeHover(node => elem.style.cursor = node ? 'pointer' : null)
      .onNodeClick(node => {
          // Aim at node from outside it
          const distance = 40;
          const distRatio = 1 + distance/Math.hypot(node.x, node.y, node.z);
          Graph.cameraPosition(
            { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio }, // new position
            node, // lookAt ({ x, y, z })
            3000  // ms transition duration
          );
        });

}

